<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, width=device-width">
  <title>OpenLayers - GeoJSON with mouseover infos</title>
  
    <link rel="alternate" type="application/atom+xml" title="RSS" href="https://equal.bbox.earth/atom.xml">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/alvaromontoro/almond.css@latest/dist/almond.lite.min.css" />
  <link rel="stylesheet" href="/style.css" />
  
    <script defer src="https://assets.bbox.earth/analytics.js" data-website-id="2598320b-4b17-46d1-9ab6-e7e3589aeed6"></script>
  
  
<script src="https://cdn.jsdelivr.net/npm/ol@10/dist/ol.js"></script>
<link href="https://cdn.jsdelivr.net/npm/ol@10/ol.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/proj4@2/dist/proj4.min.js"></script>


</head>

<body>
  
<header id="title-block-header">
<nav><a href="/">Home</a></nav>
<h1>OpenLayers - GeoJSON with mouseover infos</h1>
</header>
<div id='map'></div>
<i id="info"></i>


<p>OpenLayers map using Proj4js reprojecting GeoJSON data with mouseover function.</p>


<h3>HTML:</h3>
<pre><code>&lt;div id=&#x27;map&#x27;&gt;&lt;&#x2F;div&gt;
&lt;i id=&quot;info&quot;&gt;&lt;&#x2F;i&gt;
</code></pre>

<h3>Javascript:</h3>
<pre><code>proj4.defs(&#x27;EPSG:8857&#x27;, &#x27;+proj=eqearth +lon_0=0 +x_0=0 +y_0=0 +R=6371008.7714 +units=m +no_defs +type=crs&#x27;);
ol.proj.proj4.register(proj4);

const extent = [-17243959.06, -17243959.06, 17243959.06, 17243959.06];

const vectorLayer = new ol.layer.Vector({
  source: new ol.source.Vector({
    url: &#x27;https:&#x2F;&#x2F;openlayers.org&#x2F;data&#x2F;vector&#x2F;ecoregions.json&#x27;,
    format: new ol.format.GeoJSON(),
  }),
  style: {
    &#x27;fill-color&#x27;: [&#x27;string&#x27;, [&#x27;get&#x27;, &#x27;COLOR&#x27;], &#x27;#eee&#x27;],
  },
});

const map = new ol.Map({
  layers: [vectorLayer],
  target: &#x27;map&#x27;,
  view: new ol.View({
    center: [0, 0],
    projection: &#x27;EPSG:8857&#x27;,
    extent: extent,
    zoom: 0
  }),
});

const featureOverlay = new ol.layer.Vector({
  source: new ol.source.Vector(),
  map: map,
  style: {
    &#x27;stroke-color&#x27;: &#x27;rgba(255, 255, 255, 0.7)&#x27;,
    &#x27;stroke-width&#x27;: 2,
  },
});

let highlight;
const displayFeatureInfo = function (pixel) {
  const feature = map.forEachFeatureAtPixel(pixel, function (feature) {
    return feature;
  });

  const info = document.getElementById(&#x27;info&#x27;);
  if (feature) {
    info.innerHTML = feature.get(&#x27;ECO_NAME&#x27;) || &#x27;&amp;nbsp;&#x27;;
  } else {
    info.innerHTML = &#x27;&amp;nbsp;&#x27;;
  }

  if (feature !== highlight) {
    if (highlight) {
      featureOverlay.getSource().removeFeature(highlight);
    }
    if (feature) {
      featureOverlay.getSource().addFeature(feature);
    }
    highlight = feature;
  }
};

map.on(&#x27;pointermove&#x27;, function (evt) {
  if (evt.dragging) {
    return;
  }
  const pixel = map.getEventPixel(evt.originalEvent);
  displayFeatureInfo(pixel);
});

map.on(&#x27;click&#x27;, function (evt) {
  displayFeatureInfo(evt.pixel);
});
</code></pre>

<h3>Header:</h3>
<pre><code>&lt;script src=&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;ol@10&#x2F;dist&#x2F;ol.js&quot;&gt;&lt;&#x2F;script&gt;
&lt;link href=&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;ol@10&#x2F;ol.min.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;script src=&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;proj4@2&#x2F;dist&#x2F;proj4.min.js&quot;&gt;&lt;&#x2F;script&gt;
</code></pre>

<script>
proj4.defs('EPSG:8857', '+proj=eqearth +lon_0=0 +x_0=0 +y_0=0 +R=6371008.7714 +units=m +no_defs +type=crs');
ol.proj.proj4.register(proj4);

const extent = [-17243959.06, -17243959.06, 17243959.06, 17243959.06];

const vectorLayer = new ol.layer.Vector({
  source: new ol.source.Vector({
    url: 'https://openlayers.org/data/vector/ecoregions.json',
    format: new ol.format.GeoJSON(),
  }),
  style: {
    'fill-color': ['string', ['get', 'COLOR'], '#eee'],
  },
});

const map = new ol.Map({
  layers: [vectorLayer],
  target: 'map',
  view: new ol.View({
    center: [0, 0],
    projection: 'EPSG:8857',
    extent: extent,
    zoom: 0
  }),
});

const featureOverlay = new ol.layer.Vector({
  source: new ol.source.Vector(),
  map: map,
  style: {
    'stroke-color': 'rgba(255, 255, 255, 0.7)',
    'stroke-width': 2,
  },
});

let highlight;
const displayFeatureInfo = function (pixel) {
  const feature = map.forEachFeatureAtPixel(pixel, function (feature) {
    return feature;
  });

  const info = document.getElementById('info');
  if (feature) {
    info.innerHTML = feature.get('ECO_NAME') || '&nbsp;';
  } else {
    info.innerHTML = '&nbsp;';
  }

  if (feature !== highlight) {
    if (highlight) {
      featureOverlay.getSource().removeFeature(highlight);
    }
    if (feature) {
      featureOverlay.getSource().addFeature(feature);
    }
    highlight = feature;
  }
};

map.on('pointermove', function (evt) {
  if (evt.dragging) {
    return;
  }
  const pixel = map.getEventPixel(evt.originalEvent);
  displayFeatureInfo(pixel);
});

map.on('click', function (evt) {
  displayFeatureInfo(evt.pixel);
});

</script>


</body>

</html>
